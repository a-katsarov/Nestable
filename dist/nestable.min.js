/*
 Nestable 0.0.5
 mobius1[at]gmx[dot]com

 Sortable hierarchical list using HTML5 Drag & Drop API.

 Released under the MIT license
*/
!function(t){"use strict";function e(t,e,s,o){t.addEventListener(e,s,!1)}function s(t,e,s){t.removeEventListener(e,s)}function o(t,e,s){if("[object Object]"===Object.prototype.toString.call(t))for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(s,o,t[o]);else for(var i=0,n=t.length;i<n;i++)e.call(s,i,t[i])}function i(t,e){e=e||{};var s;for(s in t)t.hasOwnProperty(s)&&(e.hasOwnProperty(s)||(e[s]=t[s]));return e}function n(t,e){var s=document,o=s.createElement(t);if(e&&"[object Object]"===Object.prototype.toString.call(e)){var i;for(i in e)if("html"===i)o.innerHTML=e[i];else if("text"===i){var n=s.createTextNode(e[i]);o.appendChild(n)}else o.setAttribute(i,e[i])}return o}function a(t,e){if(!e)return window.getComputedStyle(t);if("[object Object]"===Object.prototype.toString.call(e)){var s="";o(e,function(t,e){"string"!=typeof e&&"opacity"!==e&&(e+="px"),s+=t+": "+e+";"}),t.style.cssText+=s}}function r(t,e,s,o){void 0!==e&&void 0!==s&&(o=o||0,t.style.cssText+="transform: translate3d("+e+"px, "+s+"px,0); transition: transform "+o+"ms")}function l(t,e){e=e||document;var s=!1;if("string"==typeof t)switch(t.charAt(0)){case".":s=e.getElementsByClassName(t.substring(1));break;case"#":s=e.getElementById(t.substring(1));break;default:s=e.getElementsByTagName(t)}return s}function c(t,e){e=e||document;var s=!1;return"string"==typeof t&&(s="#"===t.charAt(0)?e.getElementById(t.substring(1)):l(t,e)[0]),s}function d(t,e){return t&&t!==document.body&&t.nodeType===Node.ELEMENT_NODE&&(e(t)?t:d(t.parentNode,e))}function h(t,e){for(;t=t.previousElementSibling;)if(!e||e(t))return t}function p(t,e){e.parentNode.insertBefore(t,e)}function g(t,e){var s=e.nextElementSibling;s?e.parentNode.insertBefore(t,s):e.parentNode.appendChild(t)}function f(t){var e,s,o=this,i=o.config,n=t!==o.placeNode,a=u(o.placeNode);if(n){var l=u(t);e=o.targetRect.x1-l.x1,s=o.targetRect.y1-l.y1}var c=o.placeRect.x1-a.x1,d=o.placeRect.y1-a.y1;n||(c=o.oldRect.x1-a.x1,d=o.oldRect.y1-a.y1),r(o.placeNode,c,d),n&&r(t,e,s),console.log(t.offsetHeight),r(o.placeNode,0,0,i.animation),n&&r(t,0,0,i.animation),clearTimeout(t.timer),t.timer=setTimeout(function(){t.style.transform="",t.style.transition="",t.timer=!1},i.animation)}function u(t,e){var s=window,o=t.getBoundingClientRect(),i=s.pageXOffset,n=s.pageYOffset,r={},l="none";if(e){var c=a(t);r={top:parseInt(c["margin-top"],10),left:parseInt(c["margin-left"],10),right:parseInt(c["margin-right"],10),bottom:parseInt(c["margin-bottom"],10)},l=c.float}return{w:o.width,h:o.height,x1:o.left+i,x2:o.right+i,y1:o.top+n,y2:o.bottom+n,margin:r,float:l}}function m(t){this.config=i(y,t),this.dragging=!1,this.coords={last:{x:0,y:0},origin:{x:0,y:0},position:{x:0,y:0},transform:{x:0,y:0}},this.init()}var y={listName:"ol",itemName:"li",draggable:"li",rootClass:"nst-root",listClass:"nst-list",itemClass:"nst-item",parentClass:"nst-parent",handleClass:"nst-handle",buttonClass:"nst-button",contentClass:"nst-content",dragClass:"nst-dragging",placeClass:"nst-placeholder",cloneClass:"nst-clone",draggableClass:"nst-draggable",dropzoneClass:"nst-dropzone",collapsedClass:"nst-collapsed",threshold:25,animation:150},N=function(){};N.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},emit:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},N.mixin=function(t){for(var e=["on","off","emit"],s=0;s<e.length;s++)"function"==typeof t?t.prototype[e[s]]=N.prototype[e[s]]:t[e[s]]=N.prototype[e[s]];return t},m.prototype.init=function(){if(!this.initialised){var t=this.config;this.rootNode="string"==typeof t.list?c(t.list):t.list,this.rootCSS=a(this.rootNode),"static"===this.rootCSS.position&&a(this.rootNode,{position:"relative"}),this.rootNode.classList.add(t.rootClass),this.rootNode.classList.add(t.listClass);var e=l(t.itemName,this.rootNode);t.items&&("string"==typeof t.items?e=l(t.items):(t.items instanceof HTMLCollection||t.list instanceof NodeList)&&(e=t.items)),e.length&&(this.items=[],this.draggable=[],o(e,function(e,s){s.classList.add(t.itemClass);var i,a,r=t.handle;r?((i=c(t.handle,s)).classList.add(t.handleClass),a=n("div",{class:t.contentClass})):i=n("div",{class:t.handleClass+" "+t.contentClass});var l=[],d=c(t.listName,s);d?(o(s.childNodes,function(t,e){e!==d&&l.push(e)}),s.classList.add(t.parentClass),d.classList.add(t.listClass),r?s.insertBefore(a,d):s.insertBefore(i,d)):(l=[].slice.call(s.childNodes),d=n(t.listName,{class:t.listClass}),r?s.appendChild(a):s.appendChild(i),s.appendChild(n(t.listName,{class:t.listClass}))),o(l,function(t,e){r?a.appendChild(e):i.appendChild(e)}),s.setAttribute("collapsed","0"),this.items.push(s),s.matches(t.draggable)&&(s.draggable=!0,s.classList.add(t.draggableClass),this.draggable.push(s));var h=n("button",{class:t.buttonClass,type:"button"});s.insertBefore(h,s.firstElementChild)},this),N.mixin(this),this.enable())}},m.prototype.destroy=function(){if(!this.initialised){var t=this,e=t.config;t.disable(),t.rootNode.classList.remove(e.rootClass),t.rootNode.classList.remove(e.listClass),o(t.items,function(t,s){s.classList.remove(e.itemClass),s.classList.remove(e.parentClass),s.classList.remove(e.draggableClass),s.removeAttribute("collapsed"),s.removeAttribute("draggable");var i=c("."+e.buttonClass,s),n=c("."+e.contentClass,s),a=c("."+e.listClass,s);i&&s.removeChild(i),n&&(o(n.children,function(t,e){s.insertBefore(e,n)}),s.removeChild(n)),a&&(a.childElementCount?a.classList.remove(e.listClass):s.removeChild(a))},t),t.items=[],t.dragging=!1,t.coords={last:{x:0,y:0},origin:{x:0,y:0},position:{x:0,y:0},transform:{x:0,y:0}},t.initialised=!1}},m.prototype.enable=function(){if(!this.enabled){var t=this.rootNode,s=this;s.eventData={mousedown:s.rootNode,mouseup:t,dragstart:t,dragover:t,dragenter:t,drop:t,dragend:t},s.events={},o(s.eventData,function(t,o){s.events[t]=s[t].bind(s),e(o,t,s.events[t])}),e(s.rootNode,"click",function(t){var e=t.target;e.classList.contains("nst-button")&&("0"===e.parentNode.getAttribute("collapsed")?(e.parentNode.classList.add(s.config.collapsedClass),e.parentNode.setAttribute("collapsed","1")):(e.parentNode.classList.remove(s.config.collapsedClass),e.parentNode.setAttribute("collapsed","0")))}),s.enabled=!0}},m.prototype.disable=function(){this.enabled&&(o(this.eventData,function(t,e){s(e,this.events[t])},this),this.enabled=!1)},m.prototype.resize=function(t){var e=this;e.hasContainer&&(clearTimeout(e.timer),e.timer=setTimeout(e.setBoundaries(),100))},m.prototype.mousedown=function(t){var e=t.target,s=this.config,o=d(e,function(t){return t&&t.classList.contains(s.handleClass)});if(o){var i=d(o,function(t){return t&&t.classList.contains(s.itemClass)&&t.draggable});i&&(this.dragNode=i,this.coords.origin.x="touchstart"===t.type?t.touches[0].pageX:t.pageX,this.coords.origin.y="touchstart"===t.type?t.touches[0].pageY:t.pageY,this.coords.change={x:this.coords.origin.x,y:this.coords.origin.y},this.dragging=!0,this.dragNode.classList.add(s.dragClass),this.ghostNode=this.dragNode.cloneNode(!0),this.ghostNode.classList.add(s.cloneClass),this.dragRect=u(this.dragNode,!0),a(this.ghostNode,{width:this.dragRect.w,height:this.dragRect.h,top:this.dragRect.y1,left:this.dragRect.x1}),document.body.appendChild(this.ghostNode),this.setPosition(t))}},m.prototype.mouseup=function(){this.dragging&&(this.dragging=!1,this.coords.transform.x=this.coords.position.x,this.coords.transform.y=this.coords.position.y,this.stop())},m.prototype.dragstart=function(t){t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/html",""),t.dataTransfer.setDragImage(n("img"),-10,-10),this.setPlaceholder()},m.prototype.dragover=function(t){t.preventDefault&&t.preventDefault();var e=this,s=e.coords;t.dataTransfer.dropEffect="copy",e.rootNode.contains(t.target)||(t.dataTransfer.dropEffect="none"),e.dragging&&(e.setPosition(t),Math.abs(s.mouse.x-s.origin.x)>Math.abs(s.mouse.y-s.origin.y)&&(s.mouse.x-s.change.x>e.config.threshold?e.setParent():s.mouse.x-s.change.x<-e.config.threshold&&e.unsetParent()),r(e.ghostNode,s.position.x,s.position.y)),s.last.x=t.pageX,s.last.y=t.pageY},m.prototype.dragenter=function(t){var e=this,s=t.target,o=e.config,i=e.coords,n=d(s,function(t){return t&&t.classList.contains(o.contentClass)});if(n){var a=d(n,function(t){return t&&t.classList.contains(o.itemClass)});t.preventDefault();var r=i.direction.y>0,l=i.direction.y<0,c=e.placeNode.parentNode;if(!o.animation||o.animation&&!a.timer){if(o.animation&&(e.targetRect=u(a),e.placeRect=u(e.placeNode)),a.classList.contains(o.parentClass)){var h=!1;r?(h=a.lastElementChild).insertBefore(e.placeNode,h.firstElementChild):(h=a.parentNode).insertBefore(e.placeNode,a)}else r?g(e.placeNode,a):l&&p(e.placeNode,a);c.classList.contains(o.listClass)&&(!c.childElementCount||c.childElementCount<2&&c.firstElementChild===e.dragNode)&&c.parentNode.classList.remove(e.config.parentClass),o.animation&&f.call(e,a)}}},m.prototype.drop=function(t){t.preventDefault()},m.prototype.dragend=function(t){this.dragging=!1,this.stop()},m.prototype.stop=function(){if(this.currentParent=!1,this.nesting=!1,this.ghostNode){var t=this;if(t.config.animation&&t.placeNode){t.placeRect=u(t.placeNode),t.ghostRect=u(t.ghostNode);var e=t.coords.position.x-(t.ghostRect.x1-t.placeRect.x1),s=t.coords.position.y-(t.ghostRect.y1-t.placeRect.y1);a(t.ghostNode,{transform:"translate3d("+e+"px,"+s+"px,0)",transition:"transform "+t.config.animation+"ms ease 0ms"}),setTimeout(function(){t.resetDragNode(),t.reset()},t.config.animation)}else t.resetDragNode(),t.reset()}},m.prototype.resetDragNode=function(){this.dragNode.classList.remove(this.config.dragClass),a(this.dragNode,{display:"block"})},m.prototype.reset=function(){document.body.removeChild(this.ghostNode),this.ghostNode=null,this.placeNode&&this.removePlaceholder()},m.prototype.setParent=function(){var t,e=this,s=h(e.placeNode,function(t){return t&&t.classList.contains(e.config.itemClass)});s&&(t=s.getElementsByTagName(e.config.listName)).length&&(t[0].appendChild(e.placeNode),s.classList.add(e.config.parentClass),e.coords.change.x+=e.config.threshold)},m.prototype.unsetParent=function(){var t=this,e=t.placeNode.parentNode;if((t.placeNode===e.lastElementChild||t.placeNode===e.lastElementChild.previousElementSibling)&&e.classList.contains(t.config.listClass)){var s=d(t.placeNode,function(e){return e&&e.classList.contains(t.config.itemClass)});s&&s.parentNode.classList.contains(t.config.listClass)&&(g(t.placeNode,s),t.coords.change.x-=t.config.threshold,(!e.childElementCount||e.childElementCount<2&&e.firstElementChild===t.dragNode)&&s.classList.remove(t.config.parentClass),t.currentParent=!1)}},m.prototype.setPlaceholder=function(){this.placeNode=n(this.config.itemName,{class:this.config.placeClass}),this.dragNode.parentNode.insertBefore(this.placeNode,this.dragNode),this.dragRect=u(this.dragNode,!0),this.placeRect=this.dragRect,a(this.placeNode,{height:this.dragRect.h,float:this.dragRect.float,margin:[this.dragRect.margin.top,this.dragRect.margin.right,this.dragRect.margin.bottom,this.dragRect.margin.left].join("px ")+"px"}),a(this.dragNode,{display:"none"})},m.prototype.removePlaceholder=function(){this.placeNode.parentNode.replaceChild(this.dragNode,this.placeNode),this.placeNode=null,this.dragNode=null},m.prototype.setPosition=function(t){var e,s,o=this.coords,i=!this.config.axis||"x"===this.config.axis,n=!this.config.axis||"y"===this.config.axis,a="touchmove"===t.type?t.changedTouches[0].pageX:t.pageX,r="touchmove"===t.type?t.changedTouches[0].pageY:t.pageY;i&&(e=o.transform.x+(a-o.origin.x)),n&&(s=o.transform.y+(r-o.origin.y)),o.direction={x:0,y:0},i&&(e<o.position.x?o.direction.x=-1:e>o.position.x&&(o.direction.x=1)),n&&(s<o.position.y?o.direction.y=-1:s>o.position.y&&(o.direction.y=1)),o.position.x=i?e:0,o.position.y=n?s:0,o.mouse={x:t.pageX,y:t.pageY}},t.Nestable=m}(this);